# ðŸš€ BiblioFlow - Roadmap di Sviluppo

> **Progetto HCI** - Sistema di Prenotazione Posti Biblioteca Universitaria
>
> Ultimo aggiornamento: 5 Gennaio 2026

---

## ðŸ“Š Stato Generale

| Fase                       | Stato          | Progresso |
| -------------------------- | -------------- | --------- |
| 1. Setup & Configurazione  | ðŸŸ¢ Completato  | 100%      |
| 2. Database & Backend      | ðŸŸ¢ Completato  | 100%      |
| 3. Autenticazione          | ðŸŸ¢ Completato  | 100%      |
| 4. App Studente            | ðŸŸ¢ Completato  | 100%      |
| 5. Dashboard Bibliotecario | ðŸŸ¢ Completato  | 100%      |
| 6. Real-time & Notifiche   | ðŸŸ¢ Completato  | 100%      |
| 7. PWA & AccessibilitÃ      | ï¿½ In corso     | 60%       |
| 8. Testing & Deploy        | ðŸ”´ Da iniziare | 0%        |

**Legenda**: ðŸ”´ Da iniziare | ðŸŸ¡ In corso | ðŸŸ¢ Completato

---

## ðŸ“‹ FASE 1: Setup & Configurazione âœ…

### 1.1 Inizializzazione Progetto

- [x] Creare progetto Next.js 14 con App Router
- [x] Configurare TypeScript strict mode
- [x] Installare e configurare Tailwind CSS
- [x] Installare Shadcn/ui components
- [x] Configurare ESLint e Prettier
- [x] Creare struttura cartelle

### 1.2 Docker & Database

- [x] Creare docker-compose.yml (PostgreSQL + Redis)
- [x] Testare connessione database
- [x] Installare Prisma ORM
- [x] Creare schema Prisma completo

### 1.3 Variabili Ambiente

- [x] Creare .env.example
- [x] Configurare .env.local
- [x] Documentare tutte le variabili

**Deliverable**: âœ… Progetto avviabile con `npm run dev`

---

## ðŸ“‹ FASE 2: Database & Backend

### 2.1 Schema Database

- [x] **Tabella User**
  - [x] Campi base (id, email, nome, cognome, matricola)
  - [x] Ruolo (STUDENTE, BIBLIOTECARIO, ADMIN)
  - [x] Preferenze accessibilitÃ 
  - [x] Flag pendolare
  - [x] Timestamps
- [x] **Tabella Posto**

  - [x] Identificativo (numero, sala, piano)
  - [x] Caratteristiche (presa, finestra, silenzioso)
  - [x] Flag accessibile
  - [x] Stato (disponibile, occupato, manutenzione)
  - [x] Coordinate mappa (x, y)

- [x] **Tabella Prenotazione**

  - [x] Relazione User e Posto
  - [x] Data e slot orario
  - [x] Stato (confermata, check-in, completata, cancellata, no-show)
  - [x] Margine pendolare attivo
  - [x] Timestamps check-in/out

- [x] **Tabella Libro**

  - [x] Dati bibliografici (titolo, autore, ISBN)
  - [x] Posizione fisica
  - [x] DisponibilitÃ 

- [x] **Tabella Prestito**

  - [x] Relazione User e Libro
  - [x] Date prestito e scadenza
  - [x] Stato e rinnovi

- [x] **Tabella Notifica**

  - [x] Relazione User
  - [x] Tipo, titolo, messaggio
  - [x] Flag letta
  - [x] Link azione

- [x] **Tabella LogEvento** (per audit)

  - [x] Tipo evento
  - [x] EntitÃ  coinvolte
  - [x] Dettagli JSON

- [x] **Tabella AuthToken** (per verifica email/reset password)
  - [x] Token univoco
  - [x] Tipo (VERIF, RESET)
  - [x] Scadenza
  - [x] Flag usato

### 2.2 Seed Data

- [x] Script seed per utenti demo
- [x] Script seed per posti (configurazione reale biblioteca)
- [x] Script seed per libri esempio
- [x] Script seed per prenotazioni esempio

### 2.3 API Routes Base

- [x] `GET /api/health` - Health check (implicito in Next.js)
- [x] Middleware autenticazione (NextAuth)
- [x] Middleware error handling
- [x] Middleware rate limiting âœ…

**Deliverable**: âœ… Database popolato e API base funzionanti

---

## ðŸ“‹ FASE 3: Autenticazione

### 3.1 NextAuth.js Setup

- [x] Configurare NextAuth con Prisma adapter
- [x] Provider Credentials (email/password)
- [x] Provider Google OAuth (SSO universitario) âœ…
- [x] Gestione sessioni JWT
- [x] Middleware protezione route

### 3.2 Pagine Auth

- [x] Pagina Login (`/login`)
  - [x] Form email/password
  - [x] Validazione client-side
  - [x] Error handling
  - [x] Link recupero password
- [x] Pagina Registrazione (`/registrazione`)

  - [x] Form completo con matricola
  - [x] Validazione matricola universitaria (10 cifre)
  - [x] Selezione preferenze iniziali (pendolare, accessibilitÃ )
  - [x] Email di conferma con token reale

- [x] Pagina Recupero Password (`/recupera-password`)

  - [x] Form email
  - [x] Invio link reset con token reale

- [x] Pagina Reset Password (`/reset-password`)
  - [x] Form nuova password
  - [x] Validazione requisiti password
  - [x] Conferma reset

### 3.3 Gestione Ruoli

- [x] Hook `useAuth()` con ruolo utente (via NextAuth session)
- [x] HOC/middleware per route protette
- [x] Redirect automatici per ruolo

**Deliverable**: âœ… Sistema auth completo e funzionante

---

## ðŸ“‹ FASE 4: App Studente (Mobile-First) âœ… 100%

### 4.1 Layout & Navigazione âœ…

- [x] Layout responsive con header âœ…
- [x] Bottom navigation mobile âœ…
- [x] BackButton component riutilizzabile âœ…
- [x] Design system Apple-style (glassmorphism, shadows, colori) âœ…
- [x] Dark mode globale con ThemeProvider âœ…
- [x] ThemeToggle in header per tutti gli utenti âœ…
- [x] Sidebar desktop (admin) âœ…
- [x] Loading states globali âœ…

### 4.2 Dashboard Home (`/`) âœ…

- [x] Saluto personalizzato âœ…
- [x] Quick actions (4 card grandi) âœ…
- [x] Statistiche biblioteca in tempo reale âœ…
- [x] Grafico circolare occupazione âœ…
- [x] Bottom navigation âœ…
- [x] Card prenotazione attiva con countdown âœ…
- [x] Countdown timer in tempo reale âœ…
- [x] Badge caratteristiche posto âœ…
- [x] 3 bottoni azione (Check-in, Percorso, Dettagli) âœ…
- [x] Alert check-in con deadline âœ…
- [x] Sezione "Potrebbe Interessarti" âœ…
- [x] Libri Consigliati (3 card) âœ…
- [x] Posti Preferiti (3 card) âœ…
- [x] Design system responsive con gradients âœ…

### 4.3 Prenotazione Posto (`/prenota`) âœ…

- [x] **Step 1: Quando** (base)
  - [x] Calendario interattivo
  - [ ] Indicatori disponibilitÃ  per giorno
  - [x] Selezione slot orario
  - [ ] Preview posti disponibili
- [x] **Step 2: Dove** âœ…
  - [x] Mappa interattiva biblioteca SVG âœ…
  - [x] Zoom controls (ChevronLeft/Right) âœ…
  - [x] Legenda colori (disponibile/occupato/prenotato/manutenzione) âœ…
  - [x] Click su posto per dettagli âœ…
  - [x] Filtri caratteristiche (presa elettrica, accessibile) âœ…
  - [x] Card dettaglio posto selezionato âœ…
  - [x] Icone caratteristiche (âš¡ Zap, â˜€ï¸ Sun, ðŸ”‡ VolumeX, ðŸ“¶ Wifi, â™¿ Accessibility) âœ…
  - [ ] Switch tra piani (attualmente mostra piano della sala selezionata)
  - [ ] Vista lista alternativa
- [x] **Step 3: Conferma** (base)
  - [x] Riepilogo prenotazione
  - [ ] Toggle Margine Pendolare
  - [ ] Toggle notifiche percorso
  - [x] Pulsante conferma
  - [ ] Animazione successo

### 4.4 Gestione Prenotazione (`/prenotazioni`) âœ…

- [x] Lista prenotazioni attive âœ…
- [x] Card prenotazione con azioni âœ…
- [x] Check-in (QR code) âœ…
- [x] Estendi sessione âœ…
- [x] Cancella prenotazione âœ…
- [x] Storico prenotazioni âœ…

### 4.5 Estensione Sessione (`/prenotazioni/[id]/estendi`) âœ…

- [x] Timeline visuale orizzontale âœ…
- [x] Selezione slot disponibili âœ…
- [x] Verifica disponibilitÃ  real-time âœ…
- [x] Conferma estensione âœ…
- [x] Visual feedback con colori âœ…
- [x] API endpoint completo âœ…

### 4.6 Check-in (`/checkin`) âœ…

- [x] Generazione QR code dinamico âœ…
- [x] QR code contiene JSON (prenotazioneId + timestamp) âœ…
- [x] Dialog modal con QR code âœ…
- [x] Informazioni posto (numero, sala, piano) âœ…
- [x] Countdown tempo rimasto per check-in âœ…
- [x] Check-in manuale con validazioni âœ…
- [x] API endpoint `/api/prenotazioni/[id]/check-in` âœ…
- [x] Validazione stato prenotazione (CONFERMATA) âœ…
- [x] Validazione timing (15 min prima - ora inizio) âœ…
- [x] Aggiornamento stato posto (DISPONIBILE â†’ OCCUPATO) âœ…
- [x] Animazione successo check-in âœ…
- [ ] Scanner QR (per totem fisico)
- [ ] Conferma visiva successo

### 4.7 Catalogo Libri (`/libri`) âœ…

- [x] Barra ricerca per titolo, autore, ISBN âœ…
- [x] Filtri (categoria, disponibilitÃ ) âœ…
- [x] Lista risultati con card responsive âœ…
- [x] Card libro con tutte le info âœ…
  - [x] Badge categoria e disponibilitÃ  âœ…
  - [x] Titolo, autore, ISBN, editore, anno âœ…
  - [x] Posizione in biblioteca con icona MapPin âœ…
  - [x] Copie disponibili / totali âœ…
  - [x] Bottone "Richiedi Prestito" âœ…
- [x] Integration con API `/api/libri` âœ…
- [x] Gestione stati loading con skeleton âœ…
- [x] Stato vuoto quando nessun risultato âœ…
- [x] Reset filtri âœ…
- [ ] Dettaglio libro singolo (pagina separata)
- [ ] Autocomplete ricerca
- [ ] Filtro per posizione/piano

### 4.8 I Miei Prestiti (`/prestiti`)

- [x] Lista prestiti attivi
- [ ] Countdown scadenze
- [ ] Pulsante rinnova
- [ ] Storico prestiti
- [ ] Alert scadenze imminenti

### 4.9 Profilo Utente (`/profilo`) âœ…

- [x] Visualizza/modifica dati personali âœ…
- [x] Gestione preferenze âœ…
- [x] Toggle modalitÃ  accessibilitÃ  âœ…
- [x] Toggle tema scuro âœ…
- [x] Flag pendolare + tragitto âœ…
- [x] Statistiche utilizzo âœ…
- [x] Logout âœ…

### 4.10 Notifiche (`/notifiche`) âœ…

- [x] Lista notifiche âœ…
- [x] Segna come letta âœ…
- [x] Segna tutte come lette âœ…
- [x] Filtri per tipo âœ…
- [x] Link ad azioni âœ…
- [x] Badge contatore non lette âœ…

**Deliverable**: âœ… App studente completamente funzionante

---

## ðŸ“‹ FASE 5: Dashboard Bibliotecario âœ… 100%

### 5.1 Layout Admin âœ…

- [x] Sidebar navigazione collapsible âœ…
- [x] Header con breadcrumb âœ…
- [x] Layout responsive âœ…
- [x] Protezione route per ADMIN/BIBLIOTECARIO âœ…
- [x] Badge anomalie in sidebar âœ…

### 5.2 Dashboard Overview (`/admin`) âœ…

- [x] Statistiche real-time âœ…
  - [x] Posti disponibili âœ…
  - [x] Utenti totali âœ…
  - [x] % occupazione âœ…
  - [x] Prenotazioni attive âœ…
  - [x] Prestiti attivi âœ…
- [x] Feed attivitÃ  recenti âœ…
- [x] Alert e anomalie con colori âœ…
- [x] Card statistiche con trend âœ…
- [x] Azioni rapide âœ…

### 5.3 Gestione Anomalie (`/admin/anomalie`) âœ…

- [x] Statistiche anomalie (5 card) âœ…
- [x] Lista no-show recenti (ultimi 7 giorni) âœ…
- [x] Prestiti scaduti con giorni ritardo âœ…
- [x] Check-in mancanti (oggi) âœ…
- [x] Prenotazioni scadute âœ…
- [x] Azioni correttive automatiche configurabili âœ…
- [x] Stati vuoti con messaggi positivi âœ…

### 5.4 Gestione Posti (`/admin/posti`) âœ…

- [x] Statistiche veloci (4 card) âœ…
- [x] Lista posti con tabella completa âœ…
- [x] Filtri per sala, stato, caratteristiche âœ…
- [x] Badge stato colorati âœ…
- [x] Icone caratteristiche (presa, finestra, accessibile) âœ…
- [x] Azioni: manutenzione/riattiva âœ…
- [x] Contatore prenotazioni per posto âœ…

### 5.5 Gestione Utenti (`/admin/utenti`) âœ…

- [x] Statistiche utenti (6 card) âœ…
- [x] Lista utenti con ricerca âœ…
- [x] Filtri per ruolo e stato âœ…
- [x] Badge ruolo con icone âœ…
- [x] Dettaglio utente con statistiche âœ…
  - [x] Contatore prenotazioni âœ…
  - [x] Contatore prestiti âœ…
  - [x] Ultimo accesso âœ…
  - [x] Email verificata âœ…
- [x] Azioni su utente âœ…
  - [x] Attiva/Disattiva âœ…
  - [x] Esporta lista âœ…

### 5.6 Reindirizzamento Automatico âœ…

- [x] Login ADMIN/BIBLIOTECARIO â†’ `/admin` âœ…
- [x] Login STUDENTE â†’ `/` âœ…

**Deliverable**: âœ… Dashboard admin completa e funzionante

---

## ðŸ“‹ FASE 6: Real-time & Notifiche âœ… COMPLETATO

### 6.1 SSE (Server-Sent Events) Setup âœ…

- [x] `sse-emitter.ts` - Event emitter con gestione client âœ…
- [x] API `/api/sse/posti` - Endpoint SSE per real-time posti âœ…
- [x] Hook `useSSE` - Connessione client con auto-reconnect âœ…
- [x] `realtime-events.ts` - Helper per emissione eventi âœ…

### 6.2 Aggiornamenti Real-time âœ…

- [x] Infrastruttura SSE pronta âœ…
- [x] Supporto broadcast a tutti i client âœ…
- [x] Supporto rooms per filtrare eventi âœ…
- [x] Heartbeat per mantenere connessione âœ…

### 6.3 Sistema Notifiche âœ…

- [x] Modello Notifica nel database âœ…
- [x] Tipi notifica (PRENOTAZIONE, CHECK_IN_REMINDER, SCADENZA_PRESTITO, etc.) âœ…
- [x] API notifiche con cache fix (no-store) âœ…
- [x] Badge contatore non lette in header âœ…

### 6.4 Automazioni âœ… COMPLETATO

- [x] Reminder check-in (15 min prima) âœ…
- [x] Alert scadenza prestito âœ…
- [x] Rilascio automatico posto no-show âœ…
- [x] Notifica posto liberato (coda) âœ…
- [x] Service `automation-service.ts` con 4 funzioni âœ…
- [x] API `/api/cron/automations` protetta con Bearer token âœ…
- [x] Vercel Cron configurato (ogni 5 minuti) âœ…
- [x] Middleware aggiornato per route cron âœ…
- [x] Fix cache notifiche (no-store) âœ…
- [x] Seed con scenari di test âœ…

**Deliverable**: âœ… Sistema real-time e automazioni completo

---

## ðŸ“‹ FASE 7: PWA & AccessibilitÃ 

### 7.1 Progressive Web App âœ… COMPLETATO

- [x] Manifest.json completo con icone SVG âœ…
- [x] Service Worker `sw.js` con cache strategies âœ…
- [x] Offline fallback page `offline.html` âœ…
- [x] Cache strategy per assets (cache-first, network-first) âœ…
- [x] Install prompt banner âœ…
- [x] PWA Provider React con hooks âœ…
- [x] Offline indicator banner âœ…
- [x] Meta tags PWA in layout âœ…
- [x] Push notification support (infrastruttura) âœ…

### 7.2 AccessibilitÃ  (WCAG 2.1 AA)

- [ ] Navigazione da tastiera completa
- [ ] Focus management
- [ ] ARIA labels ovunque
- [ ] Screen reader testing
- [ ] Contrasto colori (4.5:1 minimo)
- [ ] Font size minimo 16px
- [ ] Touch target 44x44px
- [ ] ModalitÃ  alto contrasto
- [ ] Riduzione movimento
- [ ] Alternative testuali immagini

### 7.3 Responsive Design

- [ ] Mobile first CSS
- [ ] Breakpoints coerenti
- [ ] Testing su dispositivi reali
- [ ] Landscape mode

### 7.4 Performance

- [ ] Lighthouse score > 90
- [ ] Core Web Vitals ottimizzati
- [ ] Image optimization
- [ ] Code splitting
- [ ] Lazy loading

**Deliverable**: PWA accessibile e performante

---

## ðŸ“‹ FASE 8: Testing & Deploy

### 8.1 Testing

- [ ] Unit test componenti (Jest)
- [ ] Integration test API
- [ ] E2E test flussi principali (Playwright)
- [ ] Accessibility audit automatico
- [ ] Performance testing

### 8.2 CI/CD

- [ ] GitHub Actions workflow
- [ ] Lint + Type check
- [ ] Test automatici
- [ ] Preview deployments

### 8.3 Deploy Produzione

- [ ] Setup Vercel project
- [ ] Configurare database produzione (Supabase/Neon)
- [ ] Configurare Redis (Upstash)
- [ ] Environment variables produzione
- [ ] Custom domain (opzionale)
- [ ] Monitoring (Vercel Analytics)

### 8.4 Documentazione

- [ ] README completo
- [ ] Documentazione API (Swagger/OpenAPI)
- [ ] Guida utente
- [ ] Video demo

**Deliverable**: App in produzione su Vercel

---

## ðŸŽ¯ Milestones

| Milestone            | Target        | Descrizione                      |
| -------------------- | ------------- | -------------------------------- |
| **M1: MVP Base**     | Settimana 1-2 | Setup + Auth + Prenotazione base |
| **M2: App Completa** | Settimana 3-4 | Tutte le features studente       |
| **M3: Admin**        | Settimana 5   | Dashboard bibliotecario          |
| **M4: Real-time**    | Settimana 6   | WebSocket + notifiche            |
| **M5: Polish**       | Settimana 7   | PWA + AccessibilitÃ  + Testing    |
| **M6: Deploy**       | Settimana 8   | Produzione + Documentazione      |

---

## ðŸ“ Note & Decisioni

### Decisioni Architetturali

- **Monorepo**: No, progetto singolo Next.js per semplicitÃ 
- **State Management**: React Context + SWR per caching
- **Styling**: Tailwind CSS + Shadcn/ui
- **Database**: PostgreSQL con Prisma ORM
- **Auth**: NextAuth.js con JWT
- **Real-time**: Socket.io

### Vincoli Tecnici

- Next.js 14 con App Router
- TypeScript strict
- Mobile-first design
- WCAG 2.1 AA compliance

### Rischi Identificati

- ComplessitÃ  mappa interattiva â†’ Mitigazione: usare libreria esistente o SVG semplice
- Performance real-time â†’ Mitigazione: debounce e ottimizzazioni
- Testing accessibilitÃ  â†’ Mitigazione: tool automatici + testing manuale

---

## ðŸ“ž Contatti & Risorse

- **Repository**: [da creare]
- **Design System**: Shadcn/ui + Tailwind
- **Documentazione Next.js**: https://nextjs.org/docs
- **Prisma Docs**: https://www.prisma.io/docs

---

> **Prossimo step**: Iniziare FASE 1 - Setup del progetto Next.js
